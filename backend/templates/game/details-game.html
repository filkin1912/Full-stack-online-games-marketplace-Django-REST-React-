{% extends 'base/base.html' %}
{% load static %}
{% block content %}

<div class="details-page-wrapper">

    <!-- PAGE TITLE -->
    <p class="no-articles no-articles--welcome details-page-title">
        GAME DETAILS
    </p>

    <!-- LEFT COLUMN: GAME DETAILS -->
    <section id="game-details">
        <div class="game-details-wrapper">

            <!-- Game Image -->
            <div class="game-picture-block">
                {% if game.game_picture %}
                    <img class="entity-game-picture" src="{{ game.game_picture.url }}" alt="game picture">
                {% else %}
                    <img class="entity-game-picture" src="{% static 'images/no-image.jpg' %}" alt="game picture">
                {% endif %}
            </div>

            <!-- Game Info -->
            <div class="game-info-block">
                <h2>{{ game.title }}</h2>

                <table class="game-info-table">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Value</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr>
                            <td>Category</td>
                            <td>{{ game.category }}</td>
                        </tr>

                        <tr>
                            <td>Price</td>
                            <td>{{ game.price }} $</td>
                        </tr>

                        <tr>
                            <td>Owner</td>
                            <td>{{ game.user }}</td>
                        </tr>

                        {% if game.summary %}
                        <tr>
                            <td>Description</td>
                            <td>{{ game.summary }}</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>

                <!-- Buttons -->
                <div class="buttons">
                    {% if is_owner %}
                        <a href="{% url 'game edit' pk=game.pk %}" class="btn btn--submit">Edit</a>
                        <button class="btn btn--submit" onclick="showDeletePopup()">Delete</button>
                        <a href="{% url 'index' %}" class="go-back-btn">
                            <span class="go-back-text">Go back&nbsp;</span>
                            <img src="{% static 'images/go-back.jpg' %}" alt="Go back icon" class="go-back-icon">
                        </a>
                    {% else %}
                        <a href="{% url 'index' %}" class="go-back-btn">
                            <span class="go-back-text">Go back&nbsp;</span>
                            <img src="{% static 'images/go-back.jpg' %}" alt="Go back icon" class="go-back-icon">
                        </a>
                    {% endif %}
                </div>

            </div>
        </div>
    </section>

    <!-- RIGHT COLUMN â€” COMMENTS -->
    <div class="comment-section">

        {% for comment in comments %}
            <div class="comment-box">
                <div class="comment-inner">

                    <!-- Avatar (same as React: img.comment-avatar) -->
                    <img
                        class="comment-avatar"
                        src="{% if comment.profile_picture %}{{ comment.profile_picture.url }}{% else %}{% static 'images/default-user.jpg' %}{% endif %}"
                        alt="User avatar"
                    >

                    <!-- Content (same structure as React) -->
                    <div class="comment-content">
                        <p>
                            <span class="comment-email">{{ comment.user.email }}</span>: {{ comment.text }}
                        </p>
                    </div>

                    <!-- Delete button (same class, same position in flex row) -->
                    {% if comment.user == request.user %}
                        <form method="post" action="{% url 'delete comment' pk=comment.pk %}">
                            {% csrf_token %}
                            <button class="comment-close" title="Delete">&times;</button>
                        </form>
                    {% endif %}

                </div>
            </div>
        {% endfor %}

        <!-- Comment Form (only if user has not commented) -->
        {% if form %}
            <form method="post" class="comment-form">
                {% csrf_token %}
                {{ form.text }}
                <button type="submit" class="btn btn--details">Submit</button>
            </form>
        {% endif %}

    </div>

</div>

<!-- DELETE POPUP -->
<div id="delete-popup" class="popup-overlay" style="display: none;">
    <div class="popup-box">
        <p>Do you want to delete this game?</p>

        <form method="post" action="{% url 'game delete' pk=game.pk %}">
            {% csrf_token %}
            <button type="submit" class="btn btn--submit">Yes</button>
            <button type="button" class="btn btn--cancel" onclick="hideDeletePopup()">No</button>
        </form>
    </div>
</div>

<script>
    function showDeletePopup() {
        document.getElementById("delete-popup").style.display = "flex";
    }

    function hideDeletePopup() {
        document.getElementById("delete-popup").style.display = "none";
    }
</script>

{% endblock %}
